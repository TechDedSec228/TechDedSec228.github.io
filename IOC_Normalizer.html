<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IOC Normalizer v2.0</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #0f0f0f 0%, #1a1a1a 100%);
            color: #e0e0e0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #3a3a3a;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 5px;
            color: #2185d0;
        }

        .header p {
            color: #999;
            font-size: 13px;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        @media (max-width: 1200px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        .section {
            background: #242424;
            border: 1px solid #3a3a3a;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        }

        .section h2 {
            font-size: 16px;
            margin-bottom: 15px;
            color: #2185d0;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .section-label {
            font-size: 14px;
            color: #999;
            margin-bottom: 8px;
            display: block;
        }

        textarea {
            width: 100%;
            min-height: 150px;
            max-height: 400px;
            background: #1a1a1a;
            color: #e0e0e0;
            border: 1px solid #3a3a3a;
            border-radius: 6px;
            padding: 12px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            line-height: 1.5;
            resize: vertical;
            margin-bottom: 12px;
        }

        textarea:focus {
            outline: none;
            border-color: #2185d0;
            box-shadow: 0 0 8px rgba(33, 133, 208, 0.3);
        }

        input[type="text"] {
            width: 100%;
            background: #1a1a1a;
            color: #e0e0e0;
            border: 1px solid #3a3a3a;
            border-radius: 6px;
            padding: 12px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            margin-bottom: 15px;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: #2185d0;
            box-shadow: 0 0 8px rgba(33, 133, 208, 0.3);
        }

        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        button {
            flex: 1;
            padding: 12px 16px;
            background: #2185d0;
            color: white;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        button:hover:not(:disabled) {
            background: #1967a8;
            box-shadow: 0 4px 12px rgba(33, 133, 208, 0.4);
        }

        button:disabled {
            background: #3a3a3a;
            cursor: not-allowed;
            color: #999;
        }

        button.clear {
            background: #db2828;
        }

        button.clear:hover:not(:disabled) {
            background: #b91c1c;
        }

        .info-panel {
            background: #2a3f5f;
            border: 1px solid #3a6b99;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 20px;
            font-size: 13px;
            line-height: 1.6;
        }

        .info-panel h3 {
            color: #2185d0;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .info-panel ul {
            list-style: none;
            padding-left: 20px;
        }

        .info-panel li {
            margin-bottom: 5px;
        }

        .info-panel li:before {
            content: "‚úì ";
            color: #21ba45;
            font-weight: bold;
            margin-right: 5px;
        }

        .results-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
        }

        .result-box {
            background: #2a3f5f;
            border: 1px solid #3a6b99;
            border-radius: 8px;
            padding: 15px;
        }

        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .result-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            font-weight: 600;
            color: #2185d0;
        }

        .badge {
            background: #2185d0;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .export-btn {
            background: none;
            border: none;
            color: #2185d0;
            cursor: pointer;
            font-size: 16px;
            padding: 4px 8px;
            transition: all 0.2s ease;
        }

        .export-btn:hover {
            color: #21ba45;
            transform: scale(1.2);
        }

        .result-content {
            background: #1a1a1a;
            border: 1px solid #3a3a3a;
            border-radius: 6px;
            padding: 12px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            line-height: 1.5;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-break: break-all;
            color: #e0e0e0;
        }

        .result-content:empty:before {
            content: "–Ω–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤";
            color: #666;
            font-style: italic;
        }

        .stats-panel {
            background: #2a3f5f;
            border: 1px solid #3a6b99;
            border-radius: 6px;
            padding: 15px;
            margin-top: 20px;
            font-size: 13px;
            line-height: 1.6;
        }

        .stats-panel h3 {
            color: #21ba45;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
        }

        .stat-item {
            background: #1a1a1a;
            border: 1px solid #3a3a3a;
            padding: 10px;
            border-radius: 4px;
        }

        .stat-label {
            color: #999;
            font-size: 11px;
            margin-bottom: 3px;
        }

        .stat-value {
            color: #2185d0;
            font-weight: 600;
            font-size: 16px;
        }

        .scrollbar::-webkit-scrollbar {
            width: 8px;
        }

        .scrollbar::-webkit-scrollbar-track {
            background: #1a1a1a;
        }

        .scrollbar::-webkit-scrollbar-thumb {
            background: #3a3a3a;
            border-radius: 4px;
        }

        .scrollbar::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîç IOC Normalizer v2.0</h1>
            <p>–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –Ω–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—è —Ç–∞ –∫–ª–∞—Å–∏—Ñ—ñ–∫–∞—Ü—ñ—è Indicators of Compromise</p>
        </div>

        <div class="main-grid">
            <!-- LEFT COLUMN: INPUT -->
            <div>
                <div class="section">
                    <h2>üì• –í–≤–µ–¥–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö</h2>
                    
                    <label class="section-label">1Ô∏è‚É£ IP –∞–¥—Ä–µ—Å–∏ (IPv4)</label>
                    <textarea id="ipInput" placeholder="192.168.1.1&#10;10.0.0.1&#10;173.245.48.1&#10;109.107.168.55:443"></textarea>

                    <label class="section-label">2Ô∏è‚É£ –î–æ–º–µ–Ω–∏ (FQDN)</label>
                    <textarea id="domainInput" placeholder="example[.]com&#10;www.test.org&#10;hxxp://malware.net&#10;h–•–•p://www.mnmathleague[.]org"></textarea>

                    <label class="section-label">3Ô∏è‚É£ URL –∞–¥—Ä–µ—Å–∏</label>
                    <textarea id="urlInput" placeholder="https://example.com/path&#10;hxxps://malware.net/payload&#10;wss://canal.com/ws"></textarea>

                    <label class="section-label">4Ô∏è‚É£ –•–µ—à—ñ (MD5/SHA1/SHA256)</label>
                    <textarea id="hashInput" placeholder="5d41402abc4b2a76b9719d911017c592&#10;e5fa44f2b31c1fb553b6021e7aab6b74"></textarea>

                    <label class="section-label">üë• –ù–∞–∑–≤–∞ –∫–æ–º–∞–Ω–¥–∏/—É–≥—Ä—É–ø–æ–≤—É–≤–∞–Ω–Ω—è</label>
                    <input type="text" id="teamName" placeholder="Blue Team, BlueTeam, BTG1 —Ç–æ—â–æ">

                    <div class="controls">
                        <button id="processBtn" onclick="processIOCs()">‚öôÔ∏è Process</button>
                        <button class="clear" id="clearBtn" onclick="clearAll()">‚úï Clear</button>
                    </div>

                    <div class="info-panel">
                        <h3>‚ÑπÔ∏è –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –æ–±—Ä–æ–±–∫–∞</h3>
                        <ul>
                            <li>–ù–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—è —Ñ–æ—Ä–º–∞—Ç—ñ–≤ (hxxp‚Üíhttps, [.]‚Üí.)</li>
                            <li>–í–∏–¥–∞–ª–µ–Ω–Ω—è Cloudflare IP (15 CIDR –±–ª–æ–∫—ñ–≤)</li>
                            <li>–í–∏–¥–∞–ª–µ–Ω–Ω—è –ø—Ä–∏–≤–∞—Ç–Ω–∏—Ö IP (RFC1918)</li>
                            <li>–í–∏–¥–∞–ª–µ–Ω–Ω—è —Ö–µ—à—ñ–≤ –Ω—É–ª—å–æ–≤–∏—Ö —Ñ–∞–π–ª—ñ–≤</li>
                            <li>DNS —Ä–µ–∑–æ–ª—é—Ü—ñ—è –¥–æ–º–µ–Ω—ñ–≤ ‚Üí IP</li>
                            <li>–ó–∞–º—ñ–Ω–∞ –∫–∏—Ä–∏–ª–∏—Ü—ñ –Ω–∞ –ª–∞—Ç–∏–Ω–∏—Ü—é</li>
                            <li>–í–∏–¥–∞–ª–µ–Ω–Ω—è –¥—É–±–ª—ñ–∫–∞—Ç—ñ–≤</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- RIGHT COLUMN: RESULTS -->
            <div>
                <div id="statsPanel" class="stats-panel" style="display: none;">
                    <h3>‚úÖ –û–±—Ä–æ–±–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞</h3>
                    <div style="margin-bottom: 10px;" id="processingTime"></div>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-label">–î–æ–º–µ–Ω—ñ–≤</div>
                            <div class="stat-value" id="statDomains">0</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">URL-—ñ–≤</div>
                            <div class="stat-value" id="statUrls">0</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">IP-–∞–¥—Ä–µ—Å</div>
                            <div class="stat-value" id="statIps">0</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">–•–µ—à—ñ–≤</div>
                            <div class="stat-value" id="statHashes">0</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">–í–∏–¥–∞–ª–µ–Ω–æ</div>
                            <div class="stat-value" id="statFiltered">0</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">DNS —É—Å–ø—ñ—à–Ω–æ</div>
                            <div class="stat-value" id="statDnsSuccess">0</div>
                        </div>
                    </div>
                </div>

                <div class="results-grid">
                    <div class="result-box">
                        <div class="result-header">
                            <div class="result-title">
                                <span>üìã All IOCs</span>
                                <span class="badge" id="countAllIocs">0</span>
                            </div>
                            <button class="export-btn" onclick="exportCSV('allIocs', 'All_IOCs')">‚¨áÔ∏è</button>
                        </div>
                        <div class="result-content scrollbar" id="resultAllIocs"></div>
                    </div>

                    <div class="result-box">
                        <div class="result-header">
                            <div class="result-title">
                                <span>üåê FQDN/Domains</span>
                                <span class="badge" id="countDomains">0</span>
                            </div>
                            <button class="export-btn" onclick="exportCSV('domains', 'fqdn')">‚¨áÔ∏è</button>
                        </div>
                        <div class="result-content scrollbar" id="resultDomains"></div>
                    </div>

                    <div class="result-box">
                        <div class="result-header">
                            <div class="result-title">
                                <span>üîó URLs</span>
                                <span class="badge" id="countUrls">0</span>
                            </div>
                            <button class="export-btn" onclick="exportCSV('urls', 'URL')">‚¨áÔ∏è</button>
                        </div>
                        <div class="result-content scrollbar" id="resultUrls"></div>
                    </div>

                    <div class="result-box">
                        <div class="result-header">
                            <div class="result-title">
                                <span>üñ•Ô∏è IPs</span>
                                <span class="badge" id="countIps">0</span>
                            </div>
                            <button class="export-btn" onclick="exportCSV('ips', 'IP')">‚¨áÔ∏è</button>
                        </div>
                        <div class="result-content scrollbar" id="resultIps"></div>
                    </div>

                    <div class="result-box">
                        <div class="result-header">
                            <div class="result-title">
                                <span>üîê Hashes</span>
                                <span class="badge" id="countHashes">0</span>
                            </div>
                            <button class="export-btn" onclick="exportCSV('hashes', 'Hash')">‚¨áÔ∏è</button>
                        </div>
                        <div class="result-content scrollbar" id="resultHashes"></div>
                    </div>

                    <div class="result-box">
                        <div class="result-header">
                            <div class="result-title">
                                <span>üîç Filtered/Deleted Log</span>
                                <span class="badge" id="countFiltered">0</span>
                            </div>
                            <button class="export-btn" onclick="exportCSV('filtered', 'Filtered')">‚¨áÔ∏è</button>
                        </div>
                        <div class="result-content scrollbar" id="resultFiltered"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ============ CYRILLIC CONVERSION ============
        const cyrillicMap = {
            '–∞': 'a', '–±': 'b', '–≤': 'v', '–≥': 'g', '–¥': 'd', '–µ': 'e', '—ë': 'yo',
            '–∂': 'zh', '–∑': 'z', '–∏': 'i', '–π': 'y', '–∫': 'k', '–ª': 'l', '–º': 'm',
            '–Ω': 'n', '–æ': 'o', '–ø': 'p', '—Ä': 'r', '—Å': 's', '—Ç': 't', '—É': 'u',
            '—Ñ': 'f', '—Ö': 'h', '—Ü': 'ts', '—á': 'ch', '—à': 'sh', '—â': 'sch',
            '—ä': '', '—ã': 'y', '—å': '', '—ç': 'e', '—é': 'yu', '—è': 'ya',
            '–ê': 'A', '–ë': 'B', '–í': 'V', '–ì': 'G', '–î': 'D', '–ï': 'E', '–Å': 'YO',
            '–ñ': 'ZH', '–ó': 'Z', '–ò': 'I', '–ô': 'Y', '–ö': 'K', '–õ': 'L', '–ú': 'M',
            '–ù': 'N', '–û': 'O', '–ü': 'P', '–†': 'R', '–°': 'S', '–¢': 'T', '–£': 'U',
            '–§': 'F', '–•': 'H', '–¶': 'TS', '–ß': 'CH', '–®': 'SH', '–©': 'SCH',
            '–™': '', '–´': 'Y', '–¨': '', '–≠': 'E', '–Æ': 'YU', '–Ø': 'YA'
        };

        function cyrillicToLatin(text) {
            return text.replace(/./g, (char) => cyrillicMap[char] || char);
        }

        // ============ IP UTILITIES ============
        function ipToNumber(ip) {
            const parts = ip.split('.');
            return (parseInt(parts[0]) << 24) + (parseInt(parts[1]) << 16) + 
                   (parseInt(parts[2]) << 8) + parseInt(parts[3]);
        }

        function isIpInCIDR(ip, cidr) {
            try {
                const [network, bits] = cidr.split('/');
                const mask = -1 << (32 - parseInt(bits));
                const ipNum = ipToNumber(ip);
                const networkNum = ipToNumber(network);
                return (ipNum & mask) === (networkNum & mask);
            } catch (e) {
                return false;
            }
        }

        function isValidIp(ip) {
            const parts = ip.split('.');
            if (parts.length !== 4) return false;
            return parts.every(part => {
                const num = parseInt(part);
                return !isNaN(num) && num >= 0 && num <= 255;
            });
        }

        function isPrivateIp(ip) {
            const privateCIDRs = [
                '10.0.0.0/8',
                '172.16.0.0/12',
                '192.168.0.0/16',
                '127.0.0.0/8',
                '169.254.0.0/16'
            ];
            return privateCIDRs.some(cidr => isIpInCIDR(ip, cidr));
        }

        function isCloudflareIp(ip) {
            const cfCIDRs = [
                '173.245.48.0/20', '103.21.244.0/22', '103.22.200.0/22',
                '103.31.4.0/22', '141.101.64.0/18', '108.162.192.0/18',
                '190.93.240.0/20', '188.114.96.0/20', '197.234.240.0/22',
                '198.41.128.0/17', '162.158.0.0/15', '104.16.0.0/13',
                '104.24.0.0/14', '172.64.0.0/13', '131.0.72.0/22'
            ];
            return cfCIDRs.some(cidr => isIpInCIDR(ip, cidr));
        }

        // ============ NORMALIZATION ============
        function normalizeIP(ip) {
            // First convert cyrillic
            let normalized = cyrillicToLatin(ip);
            
            normalized = normalized.trim()
                .replace(/\[.\]/g, '.')
                .split(':')[0]; // Remove port if present
            
            if (!isValidIp(normalized)) {
                return { value: null, reason: 'Invalid Format' };
            }
            
            if (isPrivateIp(normalized)) {
                return { value: null, reason: 'Private IP' };
            }
            
            if (isCloudflareIp(normalized)) {
                return { value: null, reason: 'Cloudflare IP' };
            }
            
            return { value: normalized };
        }

        function normalizeDomain(domain) {
            // First convert cyrillic, then normalize
            let normalized = cyrillicToLatin(domain);
            
            normalized = normalized.trim()
                .replace(/\[.\]/g, '.')
                .replace(/hxx[ps]*:\/\//gi, '')
                .replace(/https?:\/\//gi, '')
                .split(':')[0] // Remove port if present
                .split('/')[0] // Remove path
                .toLowerCase()
                .trim();
            
            if (!normalized || !normalized.includes('.')) {
                return { value: null, reason: 'Invalid Format' };
            }
            
            return { value: normalized };
        }

        function normalizeURL(url) {
            // First convert cyrillic
            let normalized = cyrillicToLatin(url);
            
            normalized = normalized.trim()
                .replace(/\[.\]/g, '.');
            
            // Only normalize http/https variants, preserve other protocols
            if (!normalized.match(/^[a-z]+:\/\//i)) {
                // If no protocol, assume https
                normalized = 'https://' + normalized;
            } else if (normalized.match(/^hxx[ps]*:\/\//i)) {
                // Replace hxxp/hxxps with https
                normalized = normalized.replace(/^hxx[ps]*:\/\//i, 'https://');
            }
            
            return { value: normalized };
        }

        function normalizeHash(hash) {
            // First convert cyrillic
            let normalized = cyrillicToLatin(hash);
            
            normalized = normalized.trim()
                .toLowerCase()
                .replace(/\s/g, '');
            
            const length = normalized.length;
            let type = null;
            
            if (length === 32) {
                type = 'FileMd5';
            } else if (length === 40) {
                type = 'FileSha1';
            } else if (length === 64) {
                type = 'FileSha256';
            } else {
                return { value: null, reason: 'Invalid Format' };
            }
            
            // Null hashes
            const nullHashes = {
                'FileMd5': 'd41d8cd98f00b204e9800998ecf8427e',
                'FileSha1': 'da39a3ee5e6b4b0d3255bfef95601890afd80709',
                'FileSha256': 'e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855'
            };
            
            if (normalized === nullHashes[type]) {
                return { value: null, reason: 'Null Hash' };
            }
            
            return { value: normalized, type: type };
        }

        // ============ DNS RESOLUTION ============
        const dnsCache = {};

        async function resolveDomainDNS(domain) {
            if (dnsCache[domain] !== undefined) {
                return dnsCache[domain];
            }
            
            try {
                const response = await fetch(`https://8.8.8.8/resolve?name=${domain}&type=A`, {
                    signal: AbortSignal.timeout(5000)
                });
                
                if (!response.ok) throw new Error('DNS resolution failed');
                
                const data = await response.json();
                
                if (data.Answer && data.Answer.length > 0) {
                    const ip = data.Answer[0].data;
                    dnsCache[domain] = ip;
                    return ip;
                }
                
                dnsCache[domain] = null;
                return null;
            } catch (error) {
                dnsCache[domain] = null;
                return null;
            }
        }

        // ============ PROCESSING ============
        async function processIOCs() {
            document.getElementById('processBtn').disabled = true;
            const startTime = performance.now();
            
            const ipInputs = document.getElementById('ipInput').value
                .split('\n')
                .map(l => l.trim())
                .filter(l => l);
            
            const domainInputs = document.getElementById('domainInput').value
                .split('\n')
                .map(l => l.trim())
                .filter(l => l);
            
            const urlInputs = document.getElementById('urlInput').value
                .split('\n')
                .map(l => l.trim())
                .filter(l => l);
            
            const hashInputs = document.getElementById('hashInput').value
                .split('\n')
                .map(l => l.trim())
                .filter(l => l);
            
            const teamName = document.getElementById('teamName').value.trim() || 'Unknown';
            
            const results = {
                ips: new Set(),
                domains: new Set(),
                urls: new Set(),
                hashes: new Map(),
                allIocs: new Set(),
                filtered: [],
                dnsStats: { success: 0, failed: 0 }
            };
            
            // Process IPs
            for (const ip of ipInputs) {
                const result = normalizeIP(ip);
                if (result.value) {
                    results.ips.add(result.value);
                    results.allIocs.add(result.value);
                } else {
                    results.filtered.push({
                        value: ip,
                        reason: result.reason,
                        type: 'IP'
                    });
                }
            }
            
            // Process Domains with DNS resolution
            for (const domain of domainInputs) {
                const result = normalizeDomain(domain);
                if (result.value) {
                    results.domains.add(result.value);
                    results.allIocs.add(result.value);
                    
                    // Try DNS resolution (sequential for consistency)
                    const ip = await resolveDomainDNS(result.value);
                    if (ip) {
                        const ipResult = normalizeIP(ip);
                        if (ipResult.value) {
                            results.ips.add(ipResult.value);
                            results.allIocs.add(ipResult.value);
                            results.dnsStats.success++;
                        } else if (ipResult.reason === 'Cloudflare IP') {
                            results.filtered.push({
                                value: result.value,
                                reason: 'DNS Result: Cloudflare IP',
                                type: 'Domain'
                            });
                            results.dnsStats.failed++;
                        }
                    } else {
                        results.dnsStats.failed++;
                    }
                } else {
                    results.filtered.push({
                        value: domain,
                        reason: result.reason,
                        type: 'Domain'
                    });
                }
            }
            
            // Process URLs
            for (const url of urlInputs) {
                const result = normalizeURL(url);
                if (result.value) {
                    results.urls.add(result.value);
                    results.allIocs.add(result.value);
                } else {
                    results.filtered.push({
                        value: url,
                        reason: result.reason,
                        type: 'URL'
                    });
                }
            }
            
            // Process Hashes
            for (const hash of hashInputs) {
                const result = normalizeHash(hash);
                if (result.value) {
                    results.hashes.set(result.value, result.type);
                    results.allIocs.add(result.value);
                } else {
                    results.filtered.push({
                        value: hash,
                        reason: result.reason,
                        type: 'Hash'
                    });
                }
            }
            
            // Display results
            displayResults(results, teamName);
            
            const endTime = performance.now();
            const duration = ((endTime - startTime) / 1000).toFixed(2);
            
            displayStats(results, duration);
            document.getElementById('processBtn').disabled = false;
        }

        // ============ DISPLAY RESULTS ============
        function displayResults(results, teamName) {
            // All IOCs
            const allIocsSorted = Array.from(results.allIocs).sort();
            document.getElementById('resultAllIocs').textContent = allIocsSorted.join('\n');
            document.getElementById('countAllIocs').textContent = allIocsSorted.length;
            
            // Domains - CSV format
            const domainsSorted = Array.from(results.domains).sort();
            const domainsCSV = domainsSorted.map(d => 
                `"DomainName","${d}","","Block","Low","C2","${teamName}","","","CommandAndControl","","True"`
            ).join('\n');
            document.getElementById('resultDomains').textContent = domainsCSV;
            document.getElementById('countDomains').textContent = domainsSorted.length;
            
            // URLs - CSV format
            const urlsSorted = Array.from(results.urls).sort();
            const urlsCSV = urlsSorted.map(u => 
                `"Url","${u}","","Block","Low","Malware","${teamName}","","","CommandAndControl","","True"`
            ).join('\n');
            document.getElementById('resultUrls').textContent = urlsCSV;
            document.getElementById('countUrls').textContent = urlsSorted.length;
            
            // IPs - CSV format
            const ipsSorted = Array.from(results.ips).sort((a, b) => {
                const aNum = ipToNumber(a);
                const bNum = ipToNumber(b);
                return aNum - bNum;
            });
            const ipsCSV = ipsSorted.map(ip => 
                `"IpAddress","${ip}","","Block","Low","C2","${teamName}","","","CommandAndControl","","True"`
            ).join('\n');
            document.getElementById('resultIps').textContent = ipsCSV;
            document.getElementById('countIps').textContent = ipsSorted.length;
            
            // Hashes - CSV format
            const hashesSorted = Array.from(results.hashes.entries())
                .sort((a, b) => a[0].localeCompare(b[0]));
            const hashesCSV = hashesSorted.map(([hash, type]) => 
                `"${type}","${hash}","","BlockAndRemediate","Informational","Malware","${teamName}","","","Malware","","True"`
            ).join('\n');
            document.getElementById('resultHashes').textContent = hashesCSV;
            document.getElementById('countHashes').textContent = hashesSorted.length;
            
            // Filtered/Deleted Log
            const filteredLog = results.filtered
                .map(item => {
                    const now = new Date();
                    const time = String(now.getHours()).padStart(2, '0') + ':' +
                                String(now.getMinutes()).padStart(2, '0') + ':' +
                                String(now.getSeconds()).padStart(2, '0');
                    return `[${time}] ${item.value} | ${item.reason} | ${item.type}`;
                })
                .join('\n');
            document.getElementById('resultFiltered').textContent = filteredLog;
            document.getElementById('countFiltered').textContent = results.filtered.length;
        }

        function displayStats(results, duration) {
            document.getElementById('processingTime').textContent = `‚è±Ô∏è –û–±—Ä–æ–±–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ –∑–∞ ${duration} —Å–µ–∫`;
            document.getElementById('statDomains').textContent = results.domains.size;
            document.getElementById('statUrls').textContent = results.urls.size;
            document.getElementById('statIps').textContent = results.ips.size;
            document.getElementById('statHashes').textContent = results.hashes.size;
            document.getElementById('statFiltered').textContent = results.filtered.length;
            document.getElementById('statDnsSuccess').textContent = results.dnsStats.success;
            document.getElementById('statsPanel').style.display = 'block';
        }

        // ============ CSV EXPORT ============
        function exportCSV(type, name) {
            let content = '';
            let filename = '';
            
            const now = new Date();
            const date = String(now.getDate()).padStart(2, '0') +
                        String(now.getMonth() + 1).padStart(2, '0') +
                        now.getFullYear();
            
            const resultId = 'result' + type.charAt(0).toUpperCase() + type.slice(1);
            const element = document.getElementById(resultId);
            content = element.textContent;
            filename = `IOC_${name}_–Ü–æ–°_${date}.csv`;
            
            const blob = new Blob([content], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.setAttribute('href', URL.createObjectURL(blob));
            link.setAttribute('download', filename);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // ============ UTILITIES ============
        function clearAll() {
            document.getElementById('ipInput').value = '';
            document.getElementById('domainInput').value = '';
            document.getElementById('urlInput').value = '';
            document.getElementById('hashInput').value = '';
            document.getElementById('teamName').value = '';
            
            document.getElementById('resultAllIocs').textContent = '';
            document.getElementById('resultDomains').textContent = '';
            document.getElementById('resultUrls').textContent = '';
            document.getElementById('resultIps').textContent = '';
            document.getElementById('resultHashes').textContent = '';
            document.getElementById('resultFiltered').textContent = '';
            
            document.getElementById('countAllIocs').textContent = '0';
            document.getElementById('countDomains').textContent = '0';
            document.getElementById('countUrls').textContent = '0';
            document.getElementById('countIps').textContent = '0';
            document.getElementById('countHashes').textContent = '0';
            document.getElementById('countFiltered').textContent = '0';
            
            document.getElementById('statsPanel').style.display = 'none';
        }

        // Disable Process button if no input
        ['ipInput', 'domainInput', 'urlInput', 'hashInput'].forEach(id => {
            document.getElementById(id).addEventListener('input', () => {
                const hasInput = ['ipInput', 'domainInput', 'urlInput', 'hashInput'].some(
                    inputId => document.getElementById(inputId).value.trim() !== ''
                );
                document.getElementById('processBtn').disabled = !hasInput;
            });
        });

        // Initialize
        document.getElementById('processBtn').disabled = true;
    </script>
</body>
</html>